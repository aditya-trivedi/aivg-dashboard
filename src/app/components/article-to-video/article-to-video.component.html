<div class="article-to-video-page-container">
    <mat-stepper class="article-to-video-stepper" linear  labelPosition="bottom"  #articleToVideoStepper selectedIndex="0">

        <mat-step label="Add article text" [completed]="articleTextFormGroup.valid && !(!authService.userSubject.getValue())" >

            <form  [formGroup]="articleTextFormGroup">
                <mat-form-field style="width: 100%; height: 50vh; padding-top: 1rem;">
                    <mat-label>Article</mat-label>
                    <textarea formControlName="articleText" style="resize: none; height: 40vh;" matInput></textarea>
                    <mat-error *ngIf="!articleTextFormGroup.valid">Text should be between 100 - 2000 characters long. (<a href="/contact" target="_blank">Contact us</a> if you want more)</mat-error>
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Language of article</mat-label>
                    <mat-select formControlName="articleLanguage" required>
                        <mat-option *ngFor="let language of normalVoiceSampleAvailableLanguages" [value]="language.value">
                          {{language.displayText}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <br>
                <button style="margin-top: 1rem;" (click)="checkAuthStatus()" mat-raised-button color="primary" matStepperNext >Next</button>
            </form>
        </mat-step>



        <mat-step  label="Add Images" [completed]="imagePreviews.length > 0">

            <div class="add-image-container">

                <mat-tab-group style=" background-color:aliceblue; padding: 1rem; width: calc(100% - 2rem);">
                    
                    <mat-tab label="Generate Images"> 
                        <br>
                        <button [disabled]="generateImageButtonText.includes('...') || isImageGeneratedOnce" style="margin-bottom: 1vh;" mat-raised-button color="primary" extended (click)="generateImagesRelatedToArticle()">
                            <mat-icon>add_photo_alternate</mat-icon>
                            {{ generateImageButtonText }}
                        </button>
                        <b><p style="color: red;" *ngIf="isImageGeneratedOnce">Beta Feature : Images can be generated only once</p></b>
                        <b><p style="color: green;" *ngIf="generateImageButtonText.includes('...')">Generating images, please wait</p></b>
                        <b><p style="color: black;" >Note: Our AI technology reads your story and extracts suitable images from Google Images that are relevant to your article.</p></b>
                        <p style="color: black;" >Feel free to regenerate or upload your own images, if you don't like it.</p>
                        <mat-progress-bar mode="indeterminate" color="primary" *ngIf="generateImageButtonText.includes('...')"></mat-progress-bar>
                        <div class="selected-image-container" >
                            <p *ngIf="generatedImagePreviews.length === 0">No images generated.</p>
                            <div
                                cdkDropList
                                #generated="cdkDropList"
                                [cdkDropListData]="generatedImagePreviews"
                                [cdkDropListConnectedTo]="[final]"
                                (cdkDropListDropped)="drop($event)"
                                cdkDropListOrientation="horizontal"
                                style="display: flex; min-height: 100px;">
                                <div *ngFor="let image of generatedImagePreviews" class="selected-image-wrapper" cdkDrag>
                                    <img  class="uploaded-and-selected-image" src="{{image}}" alt=""
                                    [matTooltip]="image"
                                    matTooltipPosition="above"
                                    matTooltipClass="custom-tooltip">
                                </div>
                            </div>
                        </div>
                    </mat-tab>

                    <mat-tab label="Upload Images">
                        <br>
                        
                        <button onclick="document.getElementById('uploadImages').click()" mat-raised-button color="primary" extended>
                            <mat-icon>upload</mat-icon>
                            Upload Images
                        </button>
                        <input id="uploadImages" style="display: none;" type="file" accept="image/*" multiple (change)="selectImages($event)" multiple/>

                        <div style=" width: calc(100% - 1rem); margin-top: 1rem; ">
                            <div class="selected-image-container">
                                <p *ngIf="uploadedImagePreviews.length === 0">No images selected or uploaded</p>
                                <div
                                    cdkDropList
                                    #uploaded="cdkDropList"
                                    [cdkDropListData]="uploadedImagePreviews"
                                    [cdkDropListConnectedTo]="[final]"
                                    (cdkDropListDropped)="drop($event)"
                                    cdkDropListOrientation="horizontal"
                                    style="display: flex; min-height: 100px;">
                                    <div *ngFor="let image of uploadedImagePreviews" class="selected-image-wrapper" cdkDrag>
                                        <img  class="uploaded-and-selected-image" src="{{image}}" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>

                    </mat-tab>

                    <mat-tab label="Add images from link">

                        <br>
                        <mat-form-field>
                            <input matInput placeholder="Add Image Link" [(ngModel)]="uploadImageLink">
                        </mat-form-field>
                        <button style="margin-left: 1rem;" (click)="addImageLink()" mat-raised-button color="primary" extended>
                            <mat-icon>link</mat-icon>
                            Add Image
                        </button>
                        <mat-progress-bar mode="indeterminate" color="primary" *ngIf="fetchingImages"></mat-progress-bar>
                        <p style="color: black;" >You can copy image links from stock image websites like <a href="https://www.pexels.com" target="_blank">pexels.com</a> or <a href="https://www.unsplash.com" target="_blank">unsplash.com</a>. Just search for your image and right click on image, copy the image link and paste here.</p>

                        <div style=" width: calc(100% - 1rem); margin-top: 1rem; ">
                            <div class="selected-image-container">
                                <p *ngIf="uploadedImageLinkPreviews.length === 0">No images selected or uploaded</p>
                                <div
                                    cdkDropList
                                    #uploaded="cdkDropList"
                                    [cdkDropListData]="uploadedImageLinkPreviews"
                                    [cdkDropListConnectedTo]="[final]"
                                    (cdkDropListDropped)="drop($event)"
                                    cdkDropListOrientation="horizontal"
                                    style="display: flex; min-height: 100px;">
                                    <div *ngFor="let image of uploadedImageLinkPreviews" class="selected-image-wrapper" cdkDrag>
                                        <img  class="uploaded-and-selected-image" src="{{image}}" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>

                    </mat-tab>


                    
                </mat-tab-group>
                
                <br>
                <mat-divider></mat-divider>
                <br>
                <div style=" width: calc(100% - 1rem); ">
                    <h2>Final Order of Images</h2>
                    <p>Please drag and drop images in the box below to include in your video. You can also reorder the images.</p>
                    <p style="color: red;" *ngIf="imagePreviews.length >= 10">Maximum 10 images allowed!! (<a href="/contact" target="_blank">Contact us</a> if you want more)</p>
                    <div class="final-selected-image-container">
                        <p *ngIf="imagePreviews.length === 0">No images selected or uploaded</p>
                        <div 
                            style="display: flex; min-height: 100px;" 
                            cdkDropList
                            #final="cdkDropList"
                            [cdkDropListData]="imagePreviews"
                            [cdkDropListConnectedTo]="[uploaded, generated]"
                            (cdkDropListDropped)="drop($event)"
                            cdkDropListOrientation="horizontal">
                            <div *ngFor="let image of imagePreviews" cdkDrag class="selected-image-wrapper">
                                <img class="final-uploaded-and-selected-image" src="{{image}}" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button style="margin-top: 1rem;" mat-raised-button color="primary" matStepperPrevious>Previous</button>
            <button style="margin-top: 1rem; margin-left: 1rem;" mat-raised-button color="primary" matStepperNext>Next</button>
        </mat-step>



        <mat-step  label="Add Audio" [completed]="uploadedAudioFileSrc || generatedAudioLink">

            <p>
                Upload Voice Over or Generate a voice over for your text.
            </p>

            <mat-tab-group style=" background-color:aliceblue; padding: 1rem; width: calc(100% - 2rem);">

                <mat-tab label="Generate Voice Over" >
                    <br>
                    <p>This will generate a voice over using the text you have given in first step</p>
                    <div class="generate-voice-over">
                        <div class="normal-voice-over">
                            <h2>Free version </h2>
                            <!-- <mat-form-field>
                                <mat-label>Language</mat-label>
                                <mat-select (selectionChange)="onNormalVoiceSampleChange($event)">
                                    <mat-option *ngFor="let language of normalVoiceSampleAvailableLanguages" [value]="language.value">
                                      {{language.displayText}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <br>
                            <audio class="sample-audio-player" src="{{ currentNormalVoiceSample.audioLink }}" controls></audio>
                            <br><br> -->
                            <button (click)="generateAudio(false)" mat-raised-button color="primary" extended>
                                <mat-icon>volume_up</mat-icon>
                                Generate Free Audio
                            </button>
                        </div>
                        <div class="pro-voice-over">
                            <h2>Paid version </h2>
                            <!-- <mat-form-field>
                                <mat-label>Voice</mat-label>
                                <mat-select [(ngModel)]="paidAudioVoiceIsFemale" (selectionChange)="toggleFemaleMaleVoice($event)">
                                    <mat-option [value]="true" default>Female</mat-option>
                                    <mat-option [value]="false" >Male</mat-option>
                                </mat-select>
                            </mat-form-field> -->
                            <!-- <mat-form-field>
                                <mat-label>Language</mat-label>
                                <mat-select (selectionChange)="onPaidVoiceSampleChange($event)">
                                    <mat-option *ngFor="let language of paidVoiceSampleAvailableLanguages" [value]="language.value">
                                      {{language.displayText}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <br>
                            <audio class="sample-audio-player" src="{{ currentPaidVoiceSample.audioLink }}" controls></audio>
                            <br><br> -->
                            <button (click)="generateAudio(true)" mat-raised-button color="primary" extended>
                                Generate Premium Audio 
                                <mat-icon >monetization_on</mat-icon>
                            </button>
                        </div>
                    </div>
                    
                    <br><mat-divider></mat-divider><br>
                    <div class="audio-loading">
                        <b><p style="color : green;">{{ generateAudioStatus }}</p></b>
                        <b><p style="color : red;">{{ generateAudioError }}</p></b>
                        <mat-progress-bar mode="indeterminate" color="primary" *ngIf="generateAudioStatus=='Generating Audio...'"></mat-progress-bar>
                        <div *ngIf="generatedAudioLink">
                            <b><p style="color : green;" >Generated Audio</p></b>
                            <audio class="final-audio-player" src="{{ generatedAudioLink }}" controls></audio>
                        </div>
                    </div>
                </mat-tab>
                
                <mat-tab label="Upload Voice Over">
                    <br>
                    <button onclick="document.getElementById('uploadAudio').click()" mat-raised-button color="primary" extended>
                        <mat-icon>upload</mat-icon>
                        Upload Audio
                    </button>
                    <button *ngIf="uploadedAudioFileSrc" (click)="removeUploadedAudio()" mat-raised-button color="primary" extended style="margin-left: 1rem;">
                        <mat-icon>delete</mat-icon>
                        Remove Audio
                    </button>
                    <br><br>
                    <p>Uploaded Audio</p>
                    <input id="uploadAudio" accept="audio/*" style="display: none;" type="file" (change)="onAudioUpload($event)" />
                    <audio class="final-audio-player" [src]="uploadedAudioFileSrc" controls></audio>
                </mat-tab>

                

            </mat-tab-group>

            <button style="margin-top: 1rem;" mat-raised-button color="primary" matStepperPrevious>Previous</button>
            <button style="margin-top: 1rem; margin-left: 1rem;" mat-raised-button color="primary" matStepperNext>Next</button>
        </mat-step>

        <mat-step label="Size and Subtitles">
            <p>Select aspect ratio of your video</p>
            <mat-form-field>
                <mat-label>Video Aspect Ratio</mat-label>
                <mat-select [(ngModel)]="selectedAspectRatio" (selectionChange)="setAspectRatio($event)">
                    <mat-option *ngFor="let ratio of videoAspectRatioArray" [value]="ratio.value">
                      {{ratio.displayText}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <br> <br>
            <p>Do you want to add sub titles to your video?</p>
            <mat-slide-toggle (change)="onSubtitlesToggleChange($event)"> Subtitles </mat-slide-toggle>
            <br><br>
            <button style="margin-top: 1rem;" mat-raised-button color="primary" matStepperPrevious>Previous</button>
            <button style="margin-top: 1rem; margin-left: 1rem;" mat-raised-button color="primary" matStepperNext>Next</button>
        </mat-step>

        <mat-step label="Preview">
            <h2>Video Settings Preview</h2>
            <div>
                <mat-form-field>
                    <input matInput placeholder="Name of Video" [(ngModel)]="videoName" required>
                </mat-form-field>
                <p style="color: red;" *ngIf="videoNameError.length > 0"> {{ videoNameError }}</p>
                <p> {{ this.articleTextFormGroup.value.articleText }}</p>
                <div class="selected-image-container">
                    <div 
                        style="display: flex; min-height: 100px;" >
                        <div *ngFor="let image of imagePreviews" class="selected-image-wrapper">
                            <img class="uploaded-and-selected-image" src="{{image}}" alt="">
                        </div>
                    </div>
                </div>
                <br>
                <div>
                    <div *ngIf="uploadedAudioFileSrc && generatedAudioLink">
                        <b><p>Select Audio</p></b>
                        <mat-radio-group aria-label="Select an option" (change)="onAudioSelect($event)">
                            <mat-radio-button value="{{ uploadedAudioFileSrc }}">
                                <div>
                                    <audio src="{{ uploadedAudioFileSrc }}" controls></audio>
                                </div>
                            </mat-radio-button>
                            <mat-radio-button value="{{ generatedAudioLink }}">
                                <div>
                                    <audio src="{{ generatedAudioLink }}" controls></audio>
                                </div>
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                    <div *ngIf="!uploadedAudioFileSrc && generatedAudioLink">
                        <p>Audio</p>
                        <audio src="{{ generatedAudioLink }}" controls></audio>
                    </div>
                    <div *ngIf="uploadedAudioFileSrc && !generatedAudioLink">
                        <p>Audio</p>
                        <audio src="{{ uploadedAudioFileSrc }}" controls></audio>
                    </div>
                </div>
                <p>Aspect Ratio : {{ aspectRatioMap[selectedAspectRatio] }}</p>
                <p>Add Subtitles : {{ setSubtitles ? 'Yes' : 'No' }}</p>
            </div>
            <div>
                <button style="margin-top: 1rem;" mat-raised-button color="primary" matStepperPrevious>Previous</button>
                <button style="margin-top: 1rem; margin-left: 1rem;" mat-raised-button color="primary"
                        (click)="generateVideo()" [disabled]="generateVideoClicked">
                  <span *ngIf="!generateVideoClicked">GENERATE VIDEO</span>
                  <mat-spinner *ngIf="generateVideoClicked" diameter="20" color="accent"></mat-spinner>
                </button>
              </div>
              
        </mat-step>
      </mat-stepper>
</div>